<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WeeClick Гра</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --brand-color: #0094FE;
            --brand-color-hover: #007acd;
            --green-accent: #34D399;
            --text-main: #1a202c;
            --text-secondary: #4a5568;
            --bg-main: #f0f2f5;
            --bg-light: #ffffff;
        }
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
        }

        /* --- Екран завантаження --- */
        #loader-screen {
            background-color: var(--bg-light);
            transition: opacity 0.5s ease-out;
        }
        #logo-image-container {
            animation: pulse 2s infinite ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        #animated-logo-text {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--brand-color);
            display: inline-block;
            overflow: hidden;
            white-space: nowrap;
            border-right: .15em solid var(--brand-color);
            letter-spacing: .1em;
            animation: 
                typing 2s steps(8, end),
                blink-caret .75s step-end infinite;
        }
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--brand-color); }
        }
        #progress-bar-container {
            width: 80%;
            max-width: 300px;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 2rem;
        }
        #progress-bar {
            width: 0%;
            height: 100%;
            background-color: var(--brand-color);
            transition: width 0.1s linear;
        }
        #copyright-notice {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* --- Інші стилі --- */
        .top-panel-btn {
            background-color: var(--brand-color);
            color: white;
            transition: background-color 0.2s, transform 0.1s;
        }
        .top-panel-btn:hover {
            background-color: var(--brand-color-hover);
        }
        .top-panel-btn:active {
            transform: scale(0.95);
        }
        .bottom-nav {
            box-shadow: 0 -4px 12px rgba(0,0,0,0.08);
            flex-shrink: 0;
        }
        #nav-indicator {
            width: 32px;
            height: 32px;
            background-color: var(--green-accent);
            opacity: 0.2;
            border-radius: 50%;
            position: absolute;
            bottom: 24px;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 0;
        }
        .nav-item.active i {
            color: var(--brand-color);
        }
        #clicker-button {
            transition: transform 0.1s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 10px 20px -5px rgba(0, 148, 254, 0.4);
        }
        #clicker-button:active {
            transform: scale(0.93);
        }
        .click-animation {
            position: absolute;
            font-size: 2rem;
            font-weight: bold;
            color: var(--brand-color);
            opacity: 1;
            animation: floatUp 1s ease-out forwards;
            pointer-events: none;
        }
        @keyframes floatUp {
            from { transform: translateY(0) scale(1); opacity: 1; }
            to { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }
        #profile-modal-backdrop {
            background-color: rgba(0,0,0,0.5);
            transition: opacity 0.3s ease;
        }
        #profile-modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .premium-badge {
            background: linear-gradient(135deg, #6B49F7 0%, #D856F2 100%);
        }
    </style>
</head>
<body>

    <!-- 1. Екран завантаження -->
    <div id="loader-screen" class="w-full h-full fixed top-0 left-0 z-50 bg-white">
        <!-- Цей div центрує логотип і прогрес-бар -->
        <div class="w-full h-full flex flex-col items-center justify-center">
            <div class="flex flex-col items-center">
                <div id="logo-image-container">
                    <img src="https://weebwe.github.io/WeeClick/logo.png" alt="WeeClick Logo" class="w-32 h-32">
                </div>
                <div id="animated-logo-text" class="mt-4">WeeClick</div>
                <div id="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
            </div>
        </div>
        <!-- Корпоративні права, позиціоновані окремо -->
        <p id="copyright-notice">&copy; 2024 WeeClick. Всі права захищено.</p>
    </div>
    
    <!-- 2. Екран блокування для ботів -->
    <div id="bot-block-screen" class="w-full h-full fixed top-0 left-0 z-40 flex-col items-center justify-center bg-white hidden">
        <i class="fas fa-robot text-6xl text-red-500 mb-4"></i>
        <h1 class="text-2xl font-bold text-gray-800">Доступ заборонено</h1>
        <p class="text-gray-600 mt-2">На жаль, ботам вхід не дозволено.</p>
    </div>

    <!-- 3. Основний додаток -->
    <div id="main-app" class="w-full h-full flex-col hidden">
        
        <header class="w-full bg-white shadow-md p-3 flex justify-between items-center z-20 flex-shrink-0">
            <button id="profile-btn" class="top-panel-btn font-semibold py-2 px-4 rounded-xl flex items-center">
                <i class="fas fa-user mr-2"></i> Профіль
            </button>
            <div id="ton-connect-header" class="flex-shrink-0"></div>
        </header>
        
        <div class="w-full bg-gray-100 p-2 flex justify-around items-center z-10 shadow-inner flex-shrink-0">
            <div class="flex items-center space-x-2 font-bold text-gray-700">
                <img src="https://weebwe.github.io/WeeClick/logo.png" class="w-6 h-6"/>
                <span id="score-display">0</span>
            </div>
             <div class="flex items-center space-x-2 font-bold text-gray-700">
                <i class="fas fa-gem text-xl text-purple-500"></i>
                <span id="score2-display">0</span>
            </div>
            <div class="flex items-center space-x-2 font-bold text-gray-700">
                <i class="fas fa-heart text-xl text-red-500"></i>
                <span id="lives-display">3</span>
            </div>
        </div>

        <main class="flex-grow w-full overflow-y-auto relative">
            <section id="home-page" class="page w-full h-full flex flex-col items-center justify-center p-4">
                 <div id="clicker-button-container" class="relative flex items-center justify-center">
                    <img id="clicker-button" src="https://weebwe.github.io/WeeClick/logo.png" alt="Click Me" class="w-48 h-48 md:w-64 md:h-64 rounded-full cursor-pointer select-none">
                 </div>
                 <p class="mt-6 text-gray-500 font-medium">Натискай, щоб заробити!</p>
            </section>
            <section id="tasks-page" class="page hidden p-4 space-y-3">
                <h1 class="text-2xl font-bold mb-4">Завдання</h1>
                <div class="bg-white p-4 rounded-xl shadow">
                    <h3 class="font-bold">Підписатись на канал</h3>
                    <p class="text-sm text-gray-600">Нагорода: 1000 монет</p>
                    <button class="mt-2 top-panel-btn w-full py-2 rounded-lg">Виконати</button>
                </div>
                 <div class="bg-white p-4 rounded-xl shadow">
                    <h3 class="font-bold">Запросити друга</h3>
                    <p class="text-sm text-gray-600">Нагорода: 5000 монет за кожного</p>
                    <button class="mt-2 top-panel-btn w-full py-2 rounded-lg">Запросити</button>
                </div>
            </section>
            <section id="shop-page" class="page hidden p-4">
                <h1 class="text-2xl font-bold mb-4">Магазин</h1>
                <div class="text-center text-gray-500 mt-16">
                    <i class="fas fa-store text-5xl mb-4"></i>
                    <p>Скоро тут з'являться круті покращення!</p>
                </div>
            </section>
            <section id="leaders-page" class="page hidden p-4">
                 <h1 class="text-2xl font-bold mb-4">Таблиця лідерів</h1>
                 <div class="text-center text-gray-500 mt-16">
                    <i class="fas fa-trophy text-5xl text-yellow-500 mb-4"></i>
                    <p>Змагайся з друзями! Скоро...</p>
                </div>
            </section>
        </main>

        <nav class="bottom-nav w-full bg-white p-2 flex justify-around items-center relative z-20">
            <div id="nav-indicator"></div>
            <button data-page="home-page" class="nav-item active flex-1 flex flex-col items-center justify-center text-gray-500 z-10 py-2"><i class="fas fa-home text-2xl"></i><span class="text-xs mt-1">Головна</span></button>
            <button data-page="tasks-page" class="nav-item flex-1 flex flex-col items-center justify-center text-gray-500 z-10 py-2"><i class="fas fa-tasks text-2xl"></i><span class="text-xs mt-1">Завдання</span></button>
            <button data-page="shop-page" class="nav-item flex-1 flex flex-col items-center justify-center text-gray-500 z-10 py-2"><i class="fas fa-store text-2xl"></i><span class="text-xs mt-1">Магазин</span></button>
            <button data-page="leaders-page" class="nav-item flex-1 flex flex-col items-center justify-center text-gray-500 z-10 py-2"><i class="fas fa-trophy text-2xl"></i><span class="text-xs mt-1">Лідери</span></button>
        </nav>
    </div>

    <!-- Модальне вікно профілю -->
    <div id="profile-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div id="profile-modal-backdrop" class="absolute inset-0"></div>
        <div id="profile-modal-content" class="w-full max-w-md mx-auto bg-white rounded-2xl shadow-lg p-6 space-y-5 z-10 m-4 transform scale-95 opacity-0">
             <div class="flex justify-between items-start">
                <h2 class="text-xl font-bold">Ваш профіль</h2>
                <button id="close-profile-btn" class="text-gray-400 hover:text-gray-800">&times;</button>
            </div>
            <div class="flex items-center space-x-4">
                <img id="user-photo" src="https://placehold.co/128x128/E0E0E0/BDBDBD?text=?" alt="Аватар" class="w-16 h-16 rounded-full border-2 border-gray-200 object-cover">
                <div>
                    <h1 id="user-name" class="text-xl font-bold text-gray-800">Ім'я</h1>
                    <p id="user-username" class="text-sm text-gray-500">@username</p>
                </div>
            </div>
            <div>
                <div class="space-y-2 text-sm bg-gray-50 p-3 rounded-lg">
                    <div class="flex justify-between"><span class="text-gray-500">User ID:</span><span id="user-id" class="font-mono bg-gray-200 px-2 py-0.5 rounded"></span></div>
                    <div class="flex justify-between"><span class="text-gray-500">Статус:</span><span id="user-premium" class="font-semibold"></span></div>
                </div>
            </div>
            <div id="wallet-info" class="pt-4 border-t border-gray-100">
                 <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Підключений гаманець</h2>
                 <p id="wallet-address" class="text-sm font-mono text-center bg-gray-100 text-gray-600 p-2 rounded-lg break-all"></p>
            </div>
        </div>
    </div>


    <script type="module">
        // --- Ініціалізація Telegram та TON Connect ---
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://weebwe.github.io/WeeClick/manifest.json',
            buttonRootId: 'ton-connect-header'
        });
        
        // --- Елементи DOM ---
        const loaderScreen = document.getElementById('loader-screen');
        const progressBar = document.getElementById('progress-bar');
        const botBlockScreen = document.getElementById('bot-block-screen');
        const mainApp = document.getElementById('main-app');
        const scoreDisplay = document.getElementById('score-display');
        const score2Display = document.getElementById('score2-display');
        const livesDisplay = document.getElementById('lives-display');
        const clickerButton = document.getElementById('clicker-button');
        const clickerContainer = document.getElementById('clicker-button-container');
        const navItems = document.querySelectorAll('.nav-item');
        const navIndicator = document.getElementById('nav-indicator');
        const pages = document.querySelectorAll('.page');
        const profileBtn = document.getElementById('profile-btn');
        const profileModal = document.getElementById('profile-modal');
        const profileModalBackdrop = document.getElementById('profile-modal-backdrop');
        const profileModalContent = document.getElementById('profile-modal-content');
        const closeProfileBtn = document.getElementById('close-profile-btn');
        const userPhoto = document.getElementById('user-photo');
        const userName = document.getElementById('user-name');
        const userUsername = document.getElementById('user-username');
        const userId = document.getElementById('user-id');
        const userPremium = document.getElementById('user-premium');
        const walletAddressP = document.getElementById('wallet-address');

        // --- Ігровий стан ---
        let score = 0; let score2 = 10; let lives = 3;

        // --- Логіка завантаження ---
        function startLoadingSimulation() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 1;
                if(progressBar) {
                    progressBar.style.width = progress + '%';
                }
                if (progress >= 100) {
                    clearInterval(interval);
                    loaderScreen.style.opacity = '0';
                    mainApp.classList.remove('hidden');
                    mainApp.classList.add('flex');
                    setTimeout(() => loaderScreen.style.display = 'none', 500);
                }
            }, 25);
        }

        // --- Основна логіка ---
        function initializeApp() {
            const user = tg.initDataUnsafe?.user;
            
            if (user?.is_bot) {
                loaderScreen.style.display = 'none';
                botBlockScreen.classList.remove('hidden');
                botBlockScreen.classList.add('flex');
                return;
            }

            populateProfileData(user);
            updateWalletUI(tonConnectUI.wallet);
            updateStats();
            setupEventListeners();
            updateNavIndicator(0);
            
            startLoadingSimulation();
        }

        function populateProfileData(user) {
             if (user) {
                userName.textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim();
                userUsername.textContent = user.username ? `@${user.username}` : 'Нікнейм не вказано';
                userId.textContent = user.id;
                if (user.photo_url) userPhoto.src = user.photo_url;
                userPremium.innerHTML = user.is_premium 
                    ? `<span class="premium-badge text-white text-xs font-bold px-2 py-1 rounded-full">Premium</span>`
                    : 'Стандарт';
            } else {
                userName.textContent = "WeeClick User";
                userUsername.textContent = "@testuser";
                userId.textContent = "123456789";
                userPremium.textContent = "Стандарт";
            }
        }

        function setupEventListeners() {
            clickerButton.addEventListener('click', (event) => {
                score++;
                updateStats();
                animateClick(event);
            });
            navItems.forEach((item, index) => {
                item.addEventListener('click', () => {
                    showPage(item.dataset.page);
                    updateActiveNavItem(item);
                    updateNavIndicator(index);
                });
            });
            profileBtn.addEventListener('click', showProfileModal);
            closeProfileBtn.addEventListener('click', hideProfileModal);
            profileModalBackdrop.addEventListener('click', hideProfileModal);
            tonConnectUI.onStatusChange(updateWalletUI);
        }

        function updateStats() {
            scoreDisplay.textContent = score.toLocaleString('uk-UA');
            score2Display.textContent = score2.toLocaleString('uk-UA');
            livesDisplay.textContent = lives;
        }

        function animateClick(e) {
            const animation = document.createElement('span');
            animation.className = 'click-animation';
            animation.textContent = '+1';
            const rect = clickerContainer.getBoundingClientRect();
            const x = e.clientX - rect.left - 15;
            const y = e.clientY - rect.top - 30;
            animation.style.left = `${x}px`;
            animation.style.top = `${y}px`;
            clickerContainer.appendChild(animation);
            setTimeout(() => animation.remove(), 1000);
        }

        function showPage(pageId) {
            pages.forEach(page => page.classList.add('hidden'));
            document.getElementById(pageId)?.classList.remove('hidden');
        }

        function updateActiveNavItem(activeItem) {
             navItems.forEach(item => item.classList.remove('active'));
             activeItem.classList.add('active');
        }
        
        function updateNavIndicator(activeIndex) {
            if (navItems.length > 0) {
                const itemWidth = navItems[0].offsetWidth;
                const newPosition = activeIndex * itemWidth + (itemWidth / 2) - (navIndicator.offsetWidth / 2);
                navIndicator.style.transform = `translateX(${newPosition}px)`;
            }
        }

        function showProfileModal() {
            profileModal.classList.remove('hidden');
            setTimeout(() => {
                profileModalBackdrop.classList.remove('opacity-0');
                profileModalContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }
        
        function hideProfileModal() {
            profileModalBackdrop.classList.add('opacity-0');
            profileModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => profileModal.classList.add('hidden'), 300);
        }

        function updateWalletUI(wallet) {
            if (wallet) {
  
