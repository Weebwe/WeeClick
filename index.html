<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Профіль користувача</title>
    <!-- Tailwind CSS для стилізації -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- TonConnect UI SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <!-- Шрифт Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Використовуємо кольори, надані Telegram для теми */
            background-color: var(--tg-theme-bg-color, #f3f4f6);
            color: var(--tg-theme-text-color, #111827);
        }
        /* Анімація для завантажувача */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loader {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #0094FE;
            animation: spin 1s linear infinite;
        }
        /* Кастомізація кнопки TonConnect */
        #ton-connect-button .tc-button {
            background-color: #0094FE !important;
            color: white !important;
            width: 100%;
            transition: background-color 0.2s;
        }
        #ton-connect-button .tc-button:hover {
            background-color: #007acd !important;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- 1. Екран завантаження -->
    <div id="loader-container" class="flex flex-col items-center justify-center text-center">
        <div class="loader w-12 h-12 rounded-full"></div>
        <p class="mt-4 text-lg font-medium">Завантаження даних...</p>
    </div>

    <!-- 2. Профіль користувача (схований за замовчуванням) -->
    <div id="profile-container" class="w-full max-w-sm p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl text-center hidden">
        
        <!-- Аватарка та ім'я -->
        <img id="user-photo" src="https://placehold.co/128x128/E0E0E0/BDBDBD?text=User" alt="Аватар користувача" 
             class="w-24 h-24 rounded-full mx-auto border-4 border-gray-200">
        
        <h1 id="user-name" class="text-2xl font-bold mt-4">Ім'я користувача</h1>
        <p class="text-sm text-gray-500">Профіль Telegram</p>

        <!-- Інформація про гаманець (з'являється після підключення) -->
        <div id="wallet-info" class="mt-5 pt-4 border-t border-gray-200 hidden">
             <h2 class="text-sm font-medium text-gray-600">Адреса TON гаманця:</h2>
             <p id="wallet-address" class="text-sm font-mono text-blue-600 break-all mt-1"></p>
        </div>

        <!-- Кнопка для підключення гаманця -->
        <div id="ton-connect-button" class="mt-6 w-full">
            <!-- Сюди TonConnect UI додасть свою кнопку -->
        </div>

    </div>

    <script type="module">
        // Отримуємо доступ до елементів DOM
        const loaderContainer = document.getElementById('loader-container');
        const profileContainer = document.getElementById('profile-container');
        const userPhoto = document.getElementById('user-photo');
        const userName = document.getElementById('user-name');
        const walletInfoDiv = document.getElementById('wallet-info');
        const walletAddressP = document.getElementById('wallet-address');

        // Ініціалізуємо Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        
        // --- ІНІЦІАЛІЗАЦІЯ TON CONNECT ---
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            // ВАЖЛИВО: Створіть свій manifest.json і розмістіть на вашому сервері
            manifestUrl: 'https://gist.githubusercontent.com/siandree/734295c25cb1bac16548a3952f53489b/raw/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-button' // ID контейнера для кнопки
        });

        // Функція для оновлення UI після підключення/відключення гаманця
        const updateWalletUI = (wallet) => {
            if (wallet) {
                // Гаманець підключено
                const friendlyAddress = TON_CONNECT_UI.toUserFriendlyAddress(wallet.account.address, wallet.account.chain === '-3');
                walletAddressP.textContent = friendlyAddress;
                walletInfoDiv.classList.remove('hidden');
            } else {
                // Гаманець відключено
                walletInfoDiv.classList.add('hidden');
                walletAddressP.textContent = '';
            }
        };

        // Підписуємося на зміни статусу гаманця
        tonConnectUI.onStatusChange(updateWalletUI);

        // --- ЛОГІКА ЗАВАНТАЖЕННЯ ДАНИХ ---
        function loadUserData() {
            // Отримуємо дані користувача з Telegram
            const user = tg.initDataUnsafe?.user;

            if (user && user.id) {
                // Якщо дані є, показуємо їх
                userName.textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim();
                if (user.photo_url) {
                    userPhoto.src = user.photo_url;
                }
            } else {
                // Дані для тестування, якщо відкрити не в Telegram
                userName.textContent = "Тестовий Користувач";
                console.warn("Telegram user data not found. Using fallback data.");
            }

            // Перевіряємо, чи вже був підключений гаманець
            updateWalletUI(tonConnectUI.wallet);

            // Ховаємо завантажувач і показуємо профіль
            loaderContainer.classList.add('hidden');
            profileContainer.classList.remove('hidden');
        }

        // Симулюємо завантаження (1.5 секунди) для кращого візуального досвіду
        setTimeout(loadUserData, 1500);

    </script>
</body>
</html>

